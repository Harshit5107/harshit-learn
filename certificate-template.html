<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Harshit-Learn Certificate</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700;900&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --neon:#00F7FF;
      --bg1:#0a1929;
      --bg2:#020617;
      --muted:#94a3b8;
    }

    html,body{
      height:100%;
      margin:0;
      padding:0;
    }

    body{
      background:#070814;
      font-family:'Montserrat',sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      color:#fff;
    }

    .certificate-container{
      width:1120px;
      min-height:792px;
      padding:60px;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      border:1px solid rgba(0,247,255,0.18);
      box-shadow:0 0 40px rgba(0,247,255,0.22);
      position:relative;
      box-sizing:border-box;
    }

    .corner{
      position:absolute;
      width:80px;
      height:80px;
      border:2px solid var(--neon);
    }
    .tl{top:12px;left:12px;border-right:none;border-bottom:none;}
    .tr{top:12px;right:12px;border-left:none;border-bottom:none;}
    .bl{bottom:12px;left:12px;border-right:none;border-top:none;}
    .br{bottom:12px;right:12px;border-left:none;border-top:none;}

    .header{text-align:center;margin-bottom:20px;}
    .logo{
      width:260px;
      margin:0 auto 8px;
      display:block;
      filter:drop-shadow(0 0 26px rgba(0,247,255,0.9));
    }

    .btn{
      padding:10px 18px;
      border-radius:8px;
      border:1px solid var(--neon);
      background:var(--neon);
      color:#021020;
      font-weight:700;
      cursor:pointer;
    }

    .title{text-align:center;margin:36px 0 8px;}
    .title h1{
      font-family:'Orbitron',sans-serif;
      font-size:46px;
      margin:0;
      text-shadow:0 0 15px rgba(0,247,255,0.7);
    }

    .label{color:var(--muted);font-size:14px;margin-top:8px;}

    .student-name{
      font-family:'Orbitron',sans-serif;
      font-size:48px;
      margin:20px 0;
      font-weight:800;
      color:#00f7ff;
      text-align:center;
      letter-spacing:2px;
    }

    .course{
      font-size:26px;
      font-weight:700;
      margin:8px 0;
      color:#e6eef8;
      text-align:center;
    }

    .details{
      display:flex;
      justify-content:space-between;
      margin-top:40px;
      gap:20px;
      flex-wrap:wrap;
    }

    .detail{text-align:center;flex:1;min-width:180px;}
    .detail span{display:block;color:var(--muted);font-size:13px;}
    .detail strong{font-size:16px;margin-top:6px;display:block;}

    .signature{text-align:center;margin-top:46px;}
    .line{
      width:260px;
      height:1px;
      background:linear-gradient(90deg,transparent,var(--neon),transparent);
      margin:auto;
    }

    .status{
      position:fixed;
      right:12px;
      top:12px;
      background:rgba(0,0,0,0.5);
      color:#fff;
      padding:8px 10px;
      border-radius:8px;
      font-size:13px;
    }
  </style>
</head>

<body>

<div class="status" id="status">Loading…</div>

<div class="certificate-container" id="certificate">
  <div class="corner tl"></div>
  <div class="corner tr"></div>
  <div class="corner bl"></div>
  <div class="corner br"></div>

  <div class="header">
    <!-- ✅ FIXED LOGO PATH -->
    <img src="./assets/logo.png" class="logo" alt="Harshit-Learn Logo">
    <button class="btn" onclick="downloadPDF()">Download Certificate</button>
  </div>

  <div class="title">
    <h1>Certificate of Completion</h1>
    <p class="label">This certificate is proudly awarded to</p>
  </div>

  <div class="student-name" id="studentName">Student</div>

  <p class="label" style="text-align:center;">For successfully completing</p>
  <div class="course" id="courseName">Course</div>

  <div class="details">
    <div class="detail">
      <span>Completion Date</span>
      <strong id="completionDate">--</strong>
    </div>
    <div class="detail">
      <span>Certificate ID</span>
      <strong id="certificateId">--</strong>
    </div>
    <div class="detail">
      <span>Platform</span>
      <strong>Harshit-Learn AI</strong>
    </div>
  </div>

  <div class="signature">
    <div class="line"></div>
    <strong>Dr. Anya Sharma</strong>
    <div class="label">Lead AI Instructor</div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
  const $ = id => document.getElementById(id);

  const params = new URLSearchParams(window.location.search);
  const courseId = params.get("courseId");
  const urlName = params.get("name");
  const token = localStorage.getItem("token");

  // ✅ NAME FIX
  if (urlName) {
    $("studentName").innerText = decodeURIComponent(urlName);
  }

  function fallback() {
    $("courseName").innerText = "AI for Beginners";
    $("completionDate").innerText = new Date().toLocaleDateString("en-GB");
    $("certificateId").innerText = "HL-" + Date.now();
    $("status").innerText = "Using fallback data";
  }

  async function loadCertificate() {
    try {
      if (!token || !courseId) {
        fallback();
        return;
      }

      const res = await fetch(
        `https://harshit-learn.onrender.com/api/certificates/${courseId}`,
        { headers: { Authorization: "Bearer " + token } }
      );

      if (!res.ok) {
        fallback();
        return;
      }

      const data = await res.json();

      $("courseName").innerText = data.course?.title || "Course";
      $("completionDate").innerText =
        new Date(data.issuedAt || Date.now()).toLocaleDateString("en-GB");
      $("certificateId").innerText =
        data.certificateId || "HL-" + Date.now();

      $("status").innerText = "Loaded";
    } catch {
      fallback();
    }
  }

  function downloadPDF() {
    html2pdf().from($("certificate")).save("Harshit-Learn-Certificate.pdf");
  }

  loadCertificate();
</script>

</body>
</html>
